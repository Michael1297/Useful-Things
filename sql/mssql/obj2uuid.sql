
/*
Функция [dbo].[obj2uuid] преобразует двоичное представление объекта (binary(16)) в строку формата UUID.

Описание:
- Функция принимает значение типа binary(16), которое представляет собой 16-байтовый идентификатор.
- Преобразует его в шестнадцатеричную строку с помощью системной функции sys.fn_varbintohexsubstring.
- Форматирует строку в стандартный формат UUID: 8-4-4-4-12 символов, разделенных дефисами.

Параметры:
  @object (binary(16)): Двоичное представление объекта (16 байт). Не может быть NULL.

Возвращает:
  varchar(36): Строка в формате UUID (например, "123e4567-e89b-12d3-a456-426614174000").

Примеры использования:
  SELECT [dbo].[obj2uuid](0x123E4567E89B12D3A456426614174000);
  -- Результат: '123e4567-e89b-12d3-a456-426614174000'

  SELECT [dbo].[obj2uuid](NULL);
  -- Результат: Ошибка (параметр не может быть NULL)

Особенности:
  - Если входное значение не является binary(16), функция завершится с ошибкой.
  - Функция использует системную функцию sys.fn_varbintohexsubstring для преобразования двоичных данных в шестнадцатеричную строку.
  - Результат всегда имеет длину 36 символов (включая дефисы).

Примечание:
  Функция полезна для преобразования двоичных идентификаторов (например, уникальных идентификаторов базы данных)
  в читаемый формат UUID, который широко используется в различных системах.
*/
CREATE OR ALTER FUNCTION [dbo].[obj2uuid] (@object binary(16)) RETURNS varchar(36) AS
BEGIN
declare @s varchar(36);
set @s = sys.fn_varbintohexsubstring(0,@object,1,0);
return substring(@s, 1, 8) + '-' + substring(@s, 9, 4) + '-' + substring(@s, 13, 4) + '-' + substring(@s, 17, 4) + '-' + substring(@s, 21, 12);
END

go

